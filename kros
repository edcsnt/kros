#!/bin/sh
# Copyright 2026 edcsnt. All rights reserved.

config='
01-01
01-25
04-21
05-01
07-09
09-07
10-12
11-02
11-15
11-20
12-24
12-25
12-31
2026-02-17
2026-02-18
2026-04-03
2026-06-04
'
force=
n='
'

echo() { printf %s\\n "$*"; } >&2

ok() { case $1 in '') return 1 ;; *) return 0; esac; }

ckdate() {
	skip=
	y=${1%%-*}

	for d in $config
	do
		case $d in
			[0-9][0-9]-[0-9][0-9]) skip=$skip$n$y-$d ;;
			                    *) skip=$skip$n$d
		esac
	done
	case $skip in *${1%%T*}*) echo "$1" is a skip day; exit 1; esac
}

case $1 in -f) force=1; shift; esac
[ $# -eq 1 ] || { echo usage: "$0" [-f] file; exit 2; }

dt=$(date +%Y-%m-%dT%H:%M:%S)
ok $force || ckdate "$dt"

echo "$dt" clocking in/out
read -r f <"$1"
printf Password=%s "${f#*:}" \
	| curl -d UserName="${f%%:*}" --data-urlencode @- --no-progress-meter \
	https://www.dimepkairos.com.br/Dimep/Account/Marcacao
